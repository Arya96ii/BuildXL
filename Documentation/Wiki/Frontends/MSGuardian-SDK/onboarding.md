# Onboarding Guardian
This Guide contains information on how to integrate Guardian into a build using the Guardian SDK.

Currently the following tools are officially supported by the Guardian SDK:
-	Credscan
-	Roslyn Analyzers
-	ESLint
-	BinSkim
-	Bandit
-	SpotBugs
-	PSScriptAnalyzers

## Prerequisites
Guardian offers two different installation methods, visit aka.ms/msguardian and pick one that works best for your use case. The sample project uses the standalone install method with NuGet. Note that with the integrated install method, Guardian will automatically check for updates and write new versions of Guardian or Guardian tools under that directory. Additionally, for integrated install, provide the Guardian root directory as a partial seal directory to indicate to the Guardian SDK where to find the binaries: See the Guardian.findGuardianExecutable() function to see how this is implemented.

## Steps
### Initialize Guardian for Repository
1. Initialize Guardian at the root of the repository by running `guardian init`
    * This step only needs to be done once.
2. Commit the .gdn directory.
    * The following files should be committed:
        * .gdn/.gdnsettings
        * .gdn/.gitignore

### Generate Guardian Configuration Files
Visit the [Guardian Tools](https://dev.azure.com/securitytools/SecurityIntegration/_wiki/wikis/Guardian/1425/Guardian-Tools) section in the Guardian wiki. Pick the tools that best fit your repository.

Next, see the sample Guardian project for examples of configuration files (under `.config/guardian`) that can be used with BuildXL. All configurations for a single Guardian call should go under one .gdnconfig file. Tool configurations can be generated by running the [guardian configure](https://dev.azure.com/securitytools/SecurityIntegration/_wiki/wikis/Guardian/1395/configure) command. Generate configuration files for each tool, and combine them into a single file as follows.

1. Create a new file under `{RepositoryRoot}/.config/guardian/{configName}.gdnconfig`
2. Inside this new file, use the following template and copy the tool configs that should be used.
```
{
 "fileVersion": "1.0",
 "tools": [
  {
    Generated Tool config here
  },
  {
    Generated Tool config here
  },
}
```

## Add calls to the Guardian SDK
1. Import Guardian with `import * as Guardian from "Sdk.Guardian"`
2. Create [Guardian.GuardianArguments](../../../../Public/Sdk/Public/Tools/Guardian/Tool.Guardian.dsc) to be passed to the Guardian tool.
    * Populate this structure with the configuration file created above.
    * Ensure that files that are being scanned by Guardian as per the configuration file are properly declared under the `Guardian.GuardianArguments.filesToBeScanned` array to avoid any DFAs.
    * Some tools, such as CredScan, do not provide fine grained control over which files will be scanned. Instead they will recursively read all source files from the working directory.
3. Call `Guardian.runGuardian(args)` to run Guardian with the configuration files created above.

## Disabling Guardian, or treating Guardian errors as warnings
- To disable guardian use the following flag: `/p:[Tool.Guardian]disable=1`
  - This will change each call to Guardian into a no-op.
- To treat Guardian errors as warnings, use the following flag: `/p:[Tool.Guardian]warnOnly=1`

## Best Practices
* Try to minimize concurrent calls into Guardian wherever possible. Guardian does not officially support concurrent executions of the Guardian tool to avoid any bad interactions between tools.